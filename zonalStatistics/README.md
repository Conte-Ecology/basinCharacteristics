Zonal Statistics
================

This folder is set up to run zonal statistics on the rasters produced in other sections of the `basinCharacteristics` repo. 


## Setup: 

- The completed rasters from other sections are put into the `zonalStatistics/gisFiles/rasters` folder.
- The shapefile of the catchments to be used is put into the `zonalStatistics/gisFiles/vectors` folder.
- These two folders are not created automatically and must exist before running the script

## Steps to Run:

1. Open the `INPUTS.txt` file in the `/scrpits` folder.

2. Change the variables as necessary. Do not add extra lines or change the structure of this file other than changing 
 - "outputName" is the name that will be associated with this particular run of the tool (e.g. "NENY_HRD" for New England/NewYork High Resolution Catchments)
 - "catchmentsFileName" is the name of the catchments shapefile with extension
 - "zoneField" the name of the field that is used to identify features
 - "statType" is the statistic to calculate
 - "rasterList" is a list of the rasters to run (e.g. c("forest", "agricuture", "fwswetlends") ). If all rasters in the `raster` directory are to be run, set this variable to c("ALL")

3. The scripts are numbered. Open `1_zonalStatisticsProcessing_GIS` and set the "baseDirectory" variable to the path up to and including the `zonalStatistics` folder. Run the script in Arc Python. Allow script to run completely before moving on to the next script. If the "ZonalStatisticsAsTable" tool runs slowly, close other programs that may be using excessive memory/CPU processing power. This script outputs the specified spatial statistic for all of the catchments as `.dbf` tables in the `gisTables` folder in the run-specific versions folder (e.g. `zonalStatistics/versions/NENY_HRD/gisTables/forest_MEAN.dbf`). Example output:

| FEATUREID | COUNT  |    AREA    |    MEAN    |
|  :-----:  | ------ | ---------- | ---------- |
|   350854  |   6    | 9608.108   | 0.00000000 |
|   350855  |   1    | 1601.351   | 0.00000000 |
|   350881  |  327   | 523641.872 | 0.20795107 |
|   350888  |  105   | 168141.886 | 0.03809524 |
|   350891  |  83    | 132912.157 | 0.22891566 |
|   350897  |   6    | 9608.108   | 0.16666667 |


4. Open `2_zonalStatisticsProcessing_R` and set the "baseDirectory" variable to the path up to and including the `zonalStatistics` folder. Run the script in R. This script exists to fill in the "NA" values generated by the previous script where the catchments were too small to pull a value from the raster (see: http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#/How_Zonal_Statistics_works/009z000000wt000000/). This script gets the raster value at the centroid of the catchment polygon.

5. If `3_delineateUpstreamCatchments` has not been run, and the delineated catchments `.RData` file does not exist, then open this script, set the "baseDirectory" as in previous scripts, and run the script in R. If the delineated catchments file does exist, ensure proper naming of the file, and move it to the same directory as the tables folders (e.g. `zonalStatistics/versions/NENY_HRD/NENY_HRD_delineatedCatchments.RData`).

6.
 
 - "baseDirectory" is the path to the `zonalStatistics` folder


3. Run the script in ArcPython.

## Output Tables

The `1_zonalStatisticsProcessing_GIS` script will output `.dbf` tables in the  run-specific folder of the `zonalStatistics/tables` directory. The output table will be named to match the raster. Example output: `zonalStatistics/tables/NENY_HRD/forest.dbf`


